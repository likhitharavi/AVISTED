function DownloadFromSVG(){var n=document.getElementById("ImgFile").value;svgString2Image(svgString,600,600,"png",save)}function save(n){saveAs(n,"AVISTEDChart.png")}function saveImg(){var n=document.getElementById("chart"),r=document.querySelectorAll("svg *"),u=n.childNodes.length,i=n.getElementsByTagName("svg")[0],t=getSVGString(i);document.getElementById("ImgFile").value=t;svgString2Image(t,600,600,"png",save)}function save(n){saveAs(n,"AVISTEDChart.png")}function getSVGString(n){function u(n){function s(n,t){return t.indexOf(n)===-1?!1:!0}var r=[],f,h,e,t,c,i,l,o,u;for(r.push("#"+n.id),t=0;t<n.classList.length;t++)s("."+n.classList[t],r)||r.push("."+n.classList[t]);for(f=n.getElementsByTagName("*"),i=0;i<f.length;i++)for(h=f[i].id,s("#"+h,r)||r.push("#"+h),e=f[i].classList,t=0;t<e.length;t++)s("."+e[t],r)||r.push("."+e[t]);for(c="",i=0;i<document.styleSheets.length;i++){l=document.styleSheets[i];try{if(!l.cssRules)continue}catch(a){if(a.name!=="SecurityError")throw a;continue}for(o=l.cssRules,u=0;u<o.length;u++)s(o[u].selectorText,r)&&(c+=o[u].cssText)}return c}function f(n,t){var i=document.createElement("style"),r;i.setAttribute("type","text/css");i.innerHTML=n;r=t.hasChildNodes()?t.children[0]:null;t.insertBefore(i,r)}var i,r,t;return n.setAttribute("xlink","http://www.w3.org/1999/xlink"),i=u(n),f(i,n),r=new XMLSerializer,t=r.serializeToString(n),t=t.replace(/(\w+)?:?xlink=/g,"xmlns:xlink="),t.replace(/NS\d+:href/g,"xlink:href")}function svgString2Image(n,t,i,r,u){var e;var r=r?r:"png",s="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(n))),f=document.createElement("canvas"),o=f.getContext("2d");f.width=t;f.height=i;e=new Image;e.onload=function(){o.clearRect(0,0,t,i);o.drawImage(e,0,0,t,i);f.toBlob(function(n){var t=Math.round(n.length/1024)+" KB";u&&u(n,t)})};e.src=s}function IndexLoad(){var h=document.getElementById("Type").value,t=$("#parameter").val(),c=$("#compare").val(),o=$("#month").val(),s=$("#year").val(),f=[],r=0,i=0,u,e=0,n;if(o!==null){if(o.length>1){for(u=0;u<2;u++)for(n=0;n<t.length;n++)f[e++]=t[n]+"-"+o[u];i=1}if(s!==null&&o.length===1&&s.length===1)for(i=1,n=0;n<t.length;n++)f[e++]=t[n]+"-"+o[0]}else if(s!==null&&s.length>1){for(u=0;u<2;u++)for(n=0;n<t.length;n++)f[e++]=t[n]+"-"+s[u];r=1}if(h!==null&&t.length>0)switch(h){case"Line":e!==0?compareVariablesLine(f,i,r):compareVariablesLine(t,i,r);break;case"Area":e!==0?compareVariablesArea(f,i,r):compareVariablesArea(t,i,r);break;case"Bar":e!==0?compareBar(f,i,r):compareBar(t,i,r);break;case"Scatter":e!==0?compareScatter(f,i,r):compareScatter(t,i,r)}}function compareVariablesLine(n,t,i){var r,u,f;r="%Y-%m-%d";u="%Y-%m-%d";t===1?(r="%d",u="%d"):i===1&&(r="%m-%d",u="%m-%d");f=c3.generate({data:{keys:{x:"date",value:n},xFormat:r,url:"/Visualize/Load",mimeType:"json"},axis:{x:{type:"timeseries",tick:{format:u}}}})}function compareVariablesArea(n,t,i){var r="%Y-%m-%d",u="%Y-%m-%d",f;t===1?(r="%d",u="%d"):i===1&&(r="%m-%d",u="%m-%d");f=c3.generate({data:{keys:{x:"date",value:n},xFormat:r,url:"/Visualize/Load",mimeType:"json",type:"area"},axis:{x:{type:"timeseries",tick:{format:u}}}})}function compareBar(n,t,i){var r="%Y",u="%Y",f;t===1?(r="%d",u="%d"):i===1&&(r="%m",u="%m");f=c3.generate({data:{keys:{x:"date",value:n},xFormat:"%Y",url:"/Visualize/Load",mimeType:"json",type:"bar"},bar:{width:{ratio:.5}}})}function compareScatter(n,t,i){var r="%Y-%m-%d",u="%Y-%m-%d",f;t===1?(r="%d",u="%d"):i===1&&(r="%m-%d",u="%m-%d");f=c3.generate({data:{keys:{x:"date",value:n},xFormat:r,url:"/Visualize/Load",mimeType:"json",type:"scatter"},axis:{x:{type:"timeseries",tick:{format:u}}}})}